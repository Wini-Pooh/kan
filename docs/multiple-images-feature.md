# Документация: Множественные изображения в блоках

## Описание функциональности

Система была дополнена поддержкой множественных изображений в одном блоке. Теперь пользователи могут:

1. Добавлять несколько изображений в один блок
2. Отображать изображения в виде карточек с флекс-макетом
3. Добавлять новые изображения через кнопку "+"
4. Удалять отдельные изображения из блока
5. Добавлять подписи к каждому изображению

## Структура нового блока изображений

```html
<div class="content-block image-block" id="block_123">
    <div class="block-toolbar">
        <!-- Кнопки управления блоком -->
    </div>
    <div class="images-container">
        <div class="image-card" data-image-id="img_1">
            <button class="image-remove-btn">×</button>
            <img src="..." alt="...">
            <div class="image-caption" contenteditable="true">Подпись</div>
        </div>
        <div class="image-card" data-image-id="img_2">
            <!-- Аналогично первой карточке -->
        </div>
        <div class="add-image-btn">
            <i class="fas fa-plus"></i>
            <span>Добавить изображение</span>
        </div>
    </div>
</div>
```

## CSS классы

### .images-container
- `display: flex`
- `flex-wrap: wrap`
- `gap: 15px`
- Контейнер для изображений с флекс-макетом

### .image-card
- Карточка отдельного изображения
- `position: relative`
- `background: white`
- `border-radius: 8px`
- `box-shadow: 0 2px 8px rgba(0,0,0,0.1)`
- Анимации при наведении

### .image-remove-btn
- Кнопка удаления изображения
- `position: absolute`
- `top: 8px; right: 8px`
- Скрыта по умолчанию, появляется при hover
- Красный фон с иконкой ×

### .add-image-btn
- Кнопка добавления нового изображения
- `border: 2px dashed #007bff`
- `background: rgba(0, 123, 255, 0.05)`
- Синий цвет с иконкой +

## JavaScript функции

### handleImageUpload(event, targetBlock = null)
- Обработчик загрузки изображений
- Если `targetBlock` указан - добавляет в существующий блок
- Если нет - создает новый блок

### addImageToBlock(imageBlock, imageSrc, fileName)
- Добавляет изображение в существующий блок
- Создает новую карточку изображения
- Вставляет перед кнопкой добавления

### createImageCard(imageSrc, fileName)
- Создает HTML элемент карточки изображения
- Генерирует уникальный ID
- Добавляет кнопку удаления и подпись

### removeImageFromBlock(imageId)
- Удаляет изображение из блока
- Если это последнее изображение - удаляет весь блок
- Иначе удаляет только карточку

### addImageToCurrentBlock(blockId)
- Открывает диалог выбора файла
- Добавляет выбранное изображение в указанный блок

### updateImageBlockStructure(imageBlock)
- Обновляет старые блоки до новой структуры
- Сохраняет существующие изображения и подписи
- Добавляет кнопку для добавления новых изображений

## Обратная совместимость

Система автоматически обновляет существующие блоки изображений при загрузке страницы:

1. Функция `updateExistingElements()` проверяет все блоки
2. Для блоков изображений вызывается `updateImageBlockStructure()`
3. Старая структура преобразуется в новую без потери данных

## Адаптивность

Для мобильных устройств (ширина экрана < 768px):
- `.images-container` переключается на `flex-direction: column`
- Карточки изображений занимают всю ширину
- Кнопка добавления также растягивается на всю ширину

## Тестирование

Создан файл `test-image-blocks.html` для демонстрации:
- Нового блока с множественными изображениями
- Старого блока для проверки совместимости
- Кнопки тестирования обновления структуры

## Использование

1. Добавление нового блока: используйте существующую кнопку "Добавить изображение"
2. Добавление в существующий блок: нажмите "+" в блоке
3. Удаление изображения: наведите на карточку и нажмите "×"
4. Редактирование подписи: кликните на область подписи под изображением

## Файлы изменений

### CSS
- `resources/css/task-editor.css`: добавлены стили для новых элементов

### JavaScript
- `resources/js/task-show.js`: обновлены функции работы с изображениями

### Тестирование
- `test-image-blocks.html`: демонстрационная страница
